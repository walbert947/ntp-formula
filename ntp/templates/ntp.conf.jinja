{%- from "ntp/map.jinja" import ntp with context -%}

{% if ntp.keys|length > 0 %}
# Key file containing the keys and key identifiers used when operating with
# symmetric key cryptography.
keys {{ ntp.keys_file }}
{% endif %}

{% if ntp.config.trusted_keys is defined and ntp.keys|length > 0 %}
trustedkey {{ ntp.config.trusted_keys|join(' ') }}
{% elif ntp.keys|length > 0 %}
trustedkey {% for key in ntp.keys %}{{ key.id }} {% endfor %}
{% endif %}

# Default access restrictions
{%- for restrict in ntp.config.restrict_default %}
{{ restrict }}
{%- endfor %}

# Servers
{%- for server in ntp.config.servers %}
{{ server }}
{%- endfor %}

# Drift file.  Put this in a directory which the daemon can write to.
# No symbolic links allowed, either, since the daemon updates the file
# by creating a temporary in the same directory and then rename()'ing
# it to the file.
driftfile {{ ntp.driftfile }}

# Disable the monitoring facility to prevent amplification attacks using ntpdc
# monlist command when default restrict does not include the noquery flag. See
# CVE-2013-5211 for more details.
# Note: Monitoring will not be disabled with the limited restriction flag.
disable monitor

# Enable orphan mode
tos orphan {{ ntp.config.orphan_mode_stratum }}
